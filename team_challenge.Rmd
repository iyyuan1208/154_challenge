---
title: "MATH154 Team Challenge"
output: pdf_document
---

```{r}
library(e1071)
library(ggplot2)
library(plyr)
```
#EDA

We began our analysis by first loading the training data set and then examine the predicators.

```{r}
data_train <- read.csv('data/cs-training.csv')
colnames(data_train)
```

## Portion of defaulted
```{r}
mean(data_train$SeriousDlqin2yrs)
```


We then check each feature with summary() and see which of these features have null data and how many.

```{r}
data_col <- colnames(data_train)
for(i in 2:12){
  print(data_col[i])
  print(summary(data_train[,i]))
}
```
This suggests that only monthly income and number of dependents have missing data, which we would later either fill in or drop.

We then examine each variable to check for the existence of outliers


# Revolving-Utilization-Of-Unsecured-Lines
In the second variable "Revolving-Utilization-Of-Unsecured-Lines", which measures the total balance on credit card divided by sum of credit limits (amounts owing divided by total available for borrowing), 
the max number is 50708. That number is unlikely as we can't borrow beyond the limit by that much. Probably outlier?

Take a look at Observations with "Revolving-Utilization-Of-Unsecured-Lines" >1 and >100
There are 3338 obs with Revolving-Utilization-Of-Unsecured-Lines >1 and 223 obs with Revolving-Utilization-Of-Unsecured-Lines >100, probably treat Revolving-Utilization-Of-Unsecured-Lines >100 as outliers?

```{r}
g1 <- subset(data_train,RevolvingUtilizationOfUnsecuredLines>=1)
g2 <- subset(data_train,RevolvingUtilizationOfUnsecuredLines>=100)
summary(g1)
summary(g2)
```

# Age

An analysis of the third variable shows that the group who have experienced financial distress in the next two years have an average of age lower than the other group who have not experienced such stress.

```{r}
mage <- ddply(data_train, "SeriousDlqin2yrs", summarise, grp.mean=mean(age))
head(mage)
```

```{r, message=FALSE}
ggplot(data_train, aes(x=age, color=as.factor(SeriousDlqin2yrs),
                       fill=as.factor(SeriousDlqin2yrs))) +
  geom_vline(data=mage, aes(xintercept=grp.mean, 
                                  color=as.factor(SeriousDlqin2yrs)),
                                  linetype="dashed", size=1) +
  geom_histogram(alpha = 0.5, position = "identity") +
  scale_color_brewer(palette="Dark2")
  scale_fill_brewer(palette="Dark2")
```


# NumberOfTime30.59DaysPastDueNotWorse

In this variable, the max number is 98,which is not possible since 98*30 =2940 days, which is equivalent to 8 years. 
However, the variable measures how many times the person has been 30-59 days past dues for the past 2 years, which makes the value 98 impossible. We should remove any value >24.33 as outliers. 






## Data Cleaning

We thought about dropping the missing values, replacing missing values with medians, and using regressions to replace missing values

# These code above give us the dataframe with incompleted observations dropped 
```{r}
train_complete<- complete.cases(data)
data_drop<- cbind(data,train_complete)
data_drop<- subset(data_drop,data_drop$train_complete == TRUE)
```

# These code gave us data_median which uses the respective medians to fill in NAs in MonthlyIncome and NumberOfDependents
```{r}
data_median<-read.csv("/Users/sophiasun/Desktop/154/GiveMeSomeCredit/cs-training.csv",header= TRUE,sep=",")

for (i in 1:150000){
   if (is.na(data_median$MonthlyIncome[i])== TRUE) {
     data_median$MonthlyIncome[i] = 5400
   }
}

for (i in 1:150000){
   if (is.na(data_median$NumberOfDependents[i])== TRUE) {
     data_median$NumberOfDependents[i] = 0
   }
  }

```

